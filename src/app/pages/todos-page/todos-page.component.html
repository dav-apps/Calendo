<div class="container slide-up-in">
	<dav-header
		size="lg"
		addButtonVisible
		(addButtonClick)="addButtonClick($event)"
	>
		{{ locale.title }}
	</dav-header>

	<!--
	<p
		class="no-items-message font-weight-light text-center mt-3"
		*ngIf="
			dataService.todosWithoutDate.todos.length == 0 &&
			dataService.todosWithoutDate.todoLists.length == 0 &&
			dataService.todoDays.length == 0 &&
			dataService.todosWithoutGroup.length == 0 &&
			dataService.todoListsWithoutGroup.length == 0 &&
			dataService.todoGroups.length == 0
		"
	>
		{{ locale.noTodos }}
	</p>
	-->

	<div class="todos-list">
		@if (dataService.sortTodosByDate) { @if (todosWithoutDate.length > 0) {
		<!-- Sort by date -->
		<div>
			@for (todo of todosWithoutDate; track todo.uuid) {
			<calendo-todo-item [todo]="todo"></calendo-todo-item>
			} @for (todoList of todoListsWithoutDate; track todoList.uuid) {
			<calendo-todo-list-item [todoList]="todoList"></calendo-todo-list-item>
			}
		</div>

		<div class="divider"></div>
		} @for (todoDay of todoDays; track todoDay.formattedDate) {
		<div class="todo-day">
			<div class="todo-day-header-container">
				<h4>
					{{ todoDay.formattedDate }}
				</h4>

				<dav-icon-button
					size="sm"
					[href]="todoDay.calendarDayPageLink"
					(click)="todoDayMoreButtonClick($event, todoDay)"
				>
					<fa-icon [icon]="faArrowRightLight"></fa-icon>
				</dav-icon-button>
			</div>

			<div class="todo-day-items">
				@for (todo of todoDay.todos; track todo.uuid) {
				<calendo-todo-item [todo]="todo"></calendo-todo-item>
				} @for (todoList of todoDay.todoLists; track todoList.uuid) {
				<calendo-todo-list-item
					[todoList]="todoList"
				></calendo-todo-list-item>
				}
			</div>
		</div>
		} } @else {
		<!-- Sort by group -->
		<div class="">
			@for (todo of todosWithoutGroup; track todo.uuid) {
			<calendo-todo-item
				[todo]="todo"
				[showBadge]="false"
			></calendo-todo-item>
			} @for (todoList of todoListsWithoutGroup; track todoList.uuid) {
			<calendo-todo-list-item [todoList]="todoList"></calendo-todo-list-item>
			}
		</div>

		@for (todoGroup of todoGroups; track todoGroup.name) {
		<div class="todo-day">
			<div class="todo-day-header-container">
				<h4>
					{{ todoGroup.name }}
				</h4>
			</div>

			<div class="todo-day-items">
				@for (todo of todoGroup.todos; track todo.uuid) {
				<calendo-todo-item
					[todo]="todo"
					[showBadge]="false"
				></calendo-todo-item>
				} @for (todoList of todoGroup.todoLists; track todoList.uuid) {
				<calendo-todo-list-item
					[todoList]="todoList"
					(update)="TodoListUpdated(todoList.uuid, todoGroup.name)"
				></calendo-todo-list-item>
				}
			</div>
		</div>
		} }
	</div>
</div>

<dav-context-menu
	#addButtonContextMenu
	[visible]="addButtonContextMenuVisible"
	[posX]="addButtonContextMenuPositionX"
	[posY]="addButtonContextMenuPositionY"
>
	<dav-context-menu-item
		[value]="locale.createTodo"
		(click)="addButtonContextMenuVisible = false; createTodoDialog.show()"
	>
		<fa-icon slot="icon" [icon]="faCircleCheckLight"></fa-icon>
	</dav-context-menu-item>

	<dav-context-menu-item
		[value]="locale.createTodoList"
		(click)="addButtonContextMenuVisible = false; createTodoListDialog.show()"
	>
		<fa-icon slot="icon" [icon]="faListCheckLight"></fa-icon>
	</dav-context-menu-item>
</dav-context-menu>

<calendo-todo-dialog
	#createTodoDialog
	(primaryButtonClick)="createTodo($event)"
></calendo-todo-dialog>

<calendo-todo-dialog
	#createTodoListDialog
	mode="createTodoList"
	(primaryButtonClick)="createTodoList($event)"
></calendo-todo-dialog>
